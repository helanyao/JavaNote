# <center>Amdahl Law</center>



<br>

> 阿姆达尔定律用来计算处理器平行运算之后效率提升的能力。


#### 阿姆达尔定律定义
----------
&#12288;&#12288;一个程序（或一个算法）可按照是否可以被并行化分为下面两个部分：

1. 可以被并行化的部分
2. 不可以被并行化的部分

&#12288;&#12288;串行执行总时间记为 $$ T $$ 。时间 $$ T $$ 包括不可以被并行和可以被并行的时间。不可以被并行的记为 $$ B $$ 。可被并行的部分就是 $$ T - B $$ ：

* $$ T $$ = 串行执行的总时间 
* $$ B $$ = 不可以并行的总时间
* $$ T - B $$ = 并行部分的总时间

&#12288;&#12288;从上面可以得出：$$ T = B + (T – B) $$ ，其中 $$ T- B $$ 是可并行化的部分，可提速多少取决于有多少线程或多少CPU执行。线程或CPU个数记为 $$ N $$ 。可并行化部分被执行的最快时间可通过下面公式计算：

<center> \[ \frac{T – B}{N} \] </center>

&#12288;&#12288;根据阿姆达尔定律，当可并行部分使用 $$ N $$ 个线程或CPU执行时，执行总时间为：

<center> \[ T(N) = B + \frac{T – B}{N} \] </center>

&#12288;&#12288; $$ T(N) $$ 指在并行因子为 $$ N $$ 时的总执行时间。因此， $$ T(1) $$ 就执行在并行因子为 $$ 1 $$ 时程序的总执行时间。使用 $$ T(1) $$ 代替 $$ T $$ ，阿姆达尔定律定律看起来像这样：

<center> \[ T(N) = B + \frac{T(1) – B}{N} \] </center>

<br>



#### 一个计算例子
--------------
&#12288;&#12288;执行一个程序的总时间设为1。程序不可并行化占40%，按总时间1计算，就是0.4，可并行部分就是 $$ 1 – 0.4 = 0.6 $$ 。在并行因子为2情况下，执行时间是：

<center> \[ T(2) = 0.4 + \frac{1 – 0.4}{2} = 0.7 \] </center>

&#12288;&#12288;在并行因子为5的情况下，执行时间是：

<center> \[ T(5) = 0.4 + \frac{1 – 0.4}{5} = 0.52 \] </center>

<br>



#### 优化算法
----------------
&#12288;&#12288;从阿姆达尔定律可看出，程序可并行化部分可通过使用更多的硬件（更多的线程或CPU）运行更快。对于不可并行化的部分，只能通过优化代码来达到提速目的。

&#12288;&#12288;如果优化程序串行化部分，也可以使用阿姆达尔定律来计算程序优化后的执行时间。如果不可并行部分通过一个因子O来优化，那么阿姆达尔定律像这样：

<center> \[ T(O, N) = \frac{B}{O} + \frac{\frac{1 - B}{O}}{N} \] </center>

&#12288;&#12288;程序的不可并行化部分占了 $$ B / O $$ 时间，所以，可并行化部分就占 $$ \frac{1 - B}{O} $$ 时间。如果 $$ B $$ 为0.1，$$ O $$ 为2， $$ N $$ 为5，计算起来就像这样：

<center> \[ T(2, 5) = \frac{0.4}{2} + \frac{\frac{1 – 0.4}{2}}{5} = 0.36 \] </center>

<br>



#### 运行时间 vs 加速
-----------------
&#12288;&#12288;也可以使用阿姆达尔定律计算加速比（speedup），也就是经过优化后或者串行化后的程序或算法比原来快了多少。如果旧版本程序或算法执行时间为 $$ T $$ ，那么增速比是：

<center> \[ Speedup = \frac{T}{T(O , N)} \] </center>

&#12288;&#12288;为计算执行时间，常把 $$ T $$ 设为1，加速比为原来时间的一个分数。公式像这样：

<center> \[ Speedup = \frac{1}{T(O , N)} \] </center>

&#12288;&#12288;如果使用阿姆达尔定律代替 $$ T(O,N) $$ ，可得到下面的公式：

<center> \[ Speedup = \frac{1}{\frac{B}{O} + \frac{1 - \frac{B}{O}}{N}} \] </center>

&#12288;&#12288;如果 $$ B = 0.4 $$，$$ O = 2 $$，$$ N = 5 $$， 计算变成这样：

<center> \[ Speedup = \frac{1}{\frac{0.4}{2} + \frac{1 - \frac{0.4}{2}}{5}} = 2.78 \] </center>
