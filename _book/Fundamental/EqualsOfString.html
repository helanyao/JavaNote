
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Rewrite Equals() of String Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="String.html" />
    
    
    <link rel="prev" href="Upcast&Downcast.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Fundamental.html">
            
                <a href="Fundamental.html">
            
                    
                    Fundanmental
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="Upcast&Downcast.html">
            
                <a href="Upcast&Downcast.html">
            
                    
                    Upcast & Downcast
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.2" data-path="EqualsOfString.html">
            
                <a href="EqualsOfString.html">
            
                    
                    Rewrite Equals() of String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="String.html">
            
                <a href="String.html">
            
                    
                    String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="Class.html">
            
                <a href="Class.html">
            
                    
                    Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="Serializable.html">
            
                <a href="Serializable.html">
            
                    
                    Serializable
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Advanced/Advanced.html">
            
                <a href="../Advanced/Advanced.html">
            
                    
                    Advanced
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Advanced/ClassLoader.html">
            
                <a href="../Advanced/ClassLoader.html">
            
                    
                    Class Loader
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../Concurrent/Concurrent.html">
            
                <a href="../Concurrent/Concurrent.html">
            
                    
                    Concurrent
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../Concurrent/AQS.html">
            
                <a href="../Concurrent/AQS.html">
            
                    
                    AQS(AbstractQueuedSynchronizer)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../Concurrent/CAS.html">
            
                <a href="../Concurrent/CAS.html">
            
                    
                    CAS(Compare and Swap)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../Concurrent/CLH.html">
            
                <a href="../Concurrent/CLH.html">
            
                    
                    CLH(Craig, Landin, and Hagersten)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../Concurrent/ReentrantLock.html">
            
                <a href="../Concurrent/ReentrantLock.html">
            
                    
                    ReentrantLock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../Concurrent/Synchronized.html">
            
                <a href="../Concurrent/Synchronized.html">
            
                    
                    Synchronized
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../Concurrent/ConcurrentHashMap.html">
            
                <a href="../Concurrent/ConcurrentHashMap.html">
            
                    
                    ConcurrentHashMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../Concurrent/ThreadPool.html">
            
                <a href="../Concurrent/ThreadPool.html">
            
                    
                    ThreadPool
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Java Data Structure/JavaDataStructure.html">
            
                <a href="../Java Data Structure/JavaDataStructure.html">
            
                    
                    Java Data Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../JVM/JVM.html">
            
                <a href="../JVM/JVM.html">
            
                    
                    JVM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../JVM/GarbageCollector.html">
            
                <a href="../JVM/GarbageCollector.html">
            
                    
                    Garbage Collector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../JVM/MemoryManagement.html">
            
                <a href="../JVM/MemoryManagement.html">
            
                    
                    Memory Management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Rewrite Equals() of String</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="string&#x7684;equals">String&#x7684;equals()</h1>
<h2 id="1-solution">1. Solution</h2>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> num;
    <span class="hljs-keyword">private</span> String data;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object obj)</span> </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span> == obj) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }        
        <span class="hljs-keyword">if</span>((obj == <span class="hljs-keyword">null</span>) || (obj.getClass() != <span class="hljs-keyword">this</span>.getClass())) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }     
        <span class="hljs-comment">// object must be Test at this point</span>
        Test test = (Test)obj;
        <span class="hljs-keyword">return</span> num == test.num &amp;&amp;
         (data == test.data || (data != <span class="hljs-keyword">null</span> &amp;&amp; data.equals(test.data)));
     }

     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>{
         <span class="hljs-keyword">int</span> hash = <span class="hljs-number">7</span>;
         hash = <span class="hljs-number">31</span> * hash + num;
         hash = <span class="hljs-number">31</span> * hash + (<span class="hljs-keyword">null</span> == data ? <span class="hljs-number">0</span> : data.hashCode());
         <span class="hljs-keyword">return</span> hash;
     }

     <span class="hljs-comment">// other methods</span>
 }
</code></pre>
<h2 id="2-getclass-vs-instanceof">2. getClass() vs instanceof</h2>
<pre><code class="lang-java"><span class="hljs-keyword">if</span>((obj == <span class="hljs-keyword">null</span>) || (obj.getClass() != <span class="hljs-keyword">this</span>.getClass())) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
}
</code></pre>
<p>This conditional check is preferred instead of the conditional check given by </p>
<pre><code class="lang-java"><span class="hljs-keyword">if</span>(!(obj <span class="hljs-keyword">instanceof</span> Test)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; 
}
</code></pre>
<p>Because the first condition ensures that it will return false if the argument is a subclass of the class Test. However, in case of the second condition it fails. Thus, it might violate the symmetry requirement of the contract. The instanceof check is correct only if the class is final, so that no subclass would exist. The first condition will work for both, final and non-final classes. </p>
<p>Key points:</p>
<ul>
<li><code>instanceof</code> tests whether the object reference on the left-hand side (LHS) is an instance of the type on the right-hand side (RHS) or some subtype.</li>
<li><code>getClass() == ...</code> tests whether the types are identical.</li>
</ul>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{ }  
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span> </span>{ }  

Object o1 = <span class="hljs-keyword">new</span> A();  
Object o2 = <span class="hljs-keyword">new</span> B();  

o1 <span class="hljs-keyword">instanceof</span> A =&gt; <span class="hljs-keyword">true</span>  
o1 <span class="hljs-keyword">instanceof</span> B =&gt; <span class="hljs-keyword">false</span>  
o2 <span class="hljs-keyword">instanceof</span> A =&gt; <span class="hljs-keyword">true</span> <span class="hljs-comment">// &lt;================ HERE  </span>
o2 <span class="hljs-keyword">instanceof</span> B =&gt; <span class="hljs-keyword">true</span>  

o1.getClass().equals(A.class) =&gt; <span class="hljs-keyword">true</span>  
o1.getClass().equals(B.class) =&gt; <span class="hljs-keyword">false</span>  
o2.getClass().equals(A.class) =&gt; <span class="hljs-keyword">false</span> <span class="hljs-comment">// &lt;===============HERE  </span>
o2.getClass().equals(B.class) =&gt; <span class="hljs-keyword">true</span>
</code></pre>
<h2 id="3-guidelines">3. Guidelines</h2>
<ol>
<li>Use <code>==</code> to check if the argument is the reference to this object. This saves time when actual comparison is costly. </li>
<li>Cast the method argument to the correct type. Again, the correct type may not be the same class. Also, since this step is done after the above type-check condition, it will not result in a <em>ClassCastException</em>. </li>
<li>Compare significant variables of both, the argument object and this object and check if they are equal. If all of them are equal then return true, otherwise return false. Again, as mentioned earlier, while comparing these class members/variables; <em>primitive variables</em> can be compared directly with <code>==</code> after performing any necessary conversions (Such as float to Float.floatToIntBits or double to Double.doubleToLongBits). Whereas, <em>object references</em> can be compared by invoking their equals method recursively. You also need to ensure that invoking equals method on these object references does not result in a <code>NullPointerException</code>, as shown in Line 15.</li>
<li>Do not change the type of the argument of the equals method. It takes a <code>java.lang.Object</code> as an argument, do not use your own class instead. If you do that, you will not be overriding the equals method, but you will be overloading it instead; which would cause problems. </li>
<li>Lastly, do not forget to override the hashCode method whenever you override the equals method.</li>
<li>The class <code>java.lang.StringBuffer</code> does not override the equals method, and hence it inherits the implementation from <code>java.lang.Object</code> class.</li>
<li>If <code>null</code> is passed as an argument to the equals method, it will return false. </li>
<li>If a class field is not used in <code>equals()</code>, you should not use it in <code>hashCode()</code> method.</li>
</ol>
<h2 id="4-how-to-write-immutable-classes">4. How to write immutable classes</h2>
<ul>
<li>All of its fields are final and the class is declared final</li>
<li>Any fields that contain references to mutable objects, such as arrays, collections, or mutable classes like Date: <ul>
<li>Are private</li>
<li>Are never returned or otherwise exposed to callers</li>
<li>Are the only reference to the objects that they reference</li>
<li>Do not change the state of the referenced objects after construction</li>
</ul>
</li>
</ul>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImmutableArrayHolder</span> </span>{

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span>[] theArray;

  <span class="hljs-comment">// Right way to write a constructor -- copy the array</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ImmutableArrayHolder</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] anArray)</span> </span>{
    <span class="hljs-keyword">this</span>.theArray = (<span class="hljs-keyword">int</span>[]) anArray.clone();
  }

  <span class="hljs-comment">// Wrong way to write a constructor -- copy the reference</span>
  <span class="hljs-comment">// The caller could change the array after the call to the constructor</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ImmutableArrayHolder</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] anArray)</span> </span>{
    <span class="hljs-keyword">this</span>.theArray = anArray;
  }

  <span class="hljs-comment">// Right way to write an accessor -- don&apos;t expose the array reference</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getArrayLength</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> theArray.length }
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getArray</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span>  </span>{ <span class="hljs-keyword">return</span> theArray[n]; }

  <span class="hljs-comment">// Right way to write an accessor -- use clone()</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>[] getArray()     { <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>[]) theArray.clone(); }

  <span class="hljs-comment">// Wrong way to write an accessor -- expose the array reference</span>
  <span class="hljs-comment">// A caller could get the array reference and then change the contents</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>[] getArray()       { <span class="hljs-keyword">return</span> theArray }
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Upcast&Downcast.html" class="navigation navigation-prev " aria-label="Previous page: Upcast & Downcast">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="String.html" class="navigation navigation-next " aria-label="Next page: String">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Rewrite Equals() of String","level":"1.2.2","depth":2,"next":{"title":"String","level":"1.2.3","depth":2,"path":"Fundamental/String.md","ref":"Fundamental/String.md","articles":[]},"previous":{"title":"Upcast & Downcast","level":"1.2.1","depth":2,"path":"Fundamental/Upcast&Downcast.md","ref":"Fundamental/Upcast&Downcast.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Fundamental/EqualsOfString.md","mtime":"2016-11-04T06:56:00.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-12-03T11:01:22.920Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

